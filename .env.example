# ============================================
# ClickView Enterprise - Environment Configuration
# ============================================
# Copy this file to .env and configure for your environment
# IMPORTANT: Never commit .env file to version control

# ============================================
# NODE ENVIRONMENT
# ============================================
NODE_ENV=production  # Options: development, production, test

# ============================================
# BACKEND SERVER CONFIGURATION
# ============================================
PORT=3001
HOST=0.0.0.0

# ============================================
# DATABASE CONFIGURATION (PostgreSQL + TimescaleDB)
# ============================================
# Connection string format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://clickview_user:your_secure_password@postgres:5432/clickview_db

# Individual database connection parameters
DB_HOST=postgres
DB_PORT=5432
DB_NAME=clickview_db
DB_USER=clickview_user
DB_PASSWORD=your_secure_password
DB_SSL=false  # Set to true in production with proper SSL certificates
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=2000

# PostgreSQL Docker configuration (for docker-compose)
POSTGRES_USER=clickview_user
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=clickview_db

# ============================================
# REDIS CONFIGURATION (Caching & Sessions)
# ============================================
REDIS_URL=redis://redis:6379
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave empty for no password
REDIS_DB=0
REDIS_TTL=3600  # Default cache TTL in seconds (1 hour)

# ============================================
# SECURITY & AUTHENTICATION
# ============================================
# CRITICAL: Generate secure random keys using:
# node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# JWT Configuration
JWT_SECRET=REPLACE_WITH_128_CHAR_HEX_STRING_GENERATED_ABOVE
JWT_EXPIRES_IN=24h  # Token expiration time
JWT_REFRESH_SECRET=REPLACE_WITH_ANOTHER_128_CHAR_HEX_STRING
JWT_REFRESH_EXPIRES_IN=7d  # Refresh token expiration

# Session Configuration
SESSION_SECRET=REPLACE_WITH_128_CHAR_HEX_STRING_FOR_SESSION
SESSION_MAX_AGE=86400000  # 24 hours in milliseconds
SESSION_SECURE=true  # Set to true in production (requires HTTPS)
SESSION_SAME_SITE=lax  # Options: strict, lax, none

# Encryption (for sensitive data at rest)
ENCRYPTION_KEY=REPLACE_WITH_64_CHAR_HEX_STRING_FOR_ENCRYPTION
ENCRYPTION_ALGORITHM=aes-256-gcm

# Password Policy
PASSWORD_MIN_LENGTH=12
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL=true
PASSWORD_MAX_AGE_DAYS=90  # Force password change after N days
BCRYPT_ROUNDS=12  # Higher = more secure but slower

# Multi-Factor Authentication (MFA)
MFA_ENABLED=true
MFA_ISSUER=ClickView Enterprise
MFA_WINDOW=1  # Allow 1 time step before/after current

# Account Lockout
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900000  # 15 minutes in milliseconds
LOCKOUT_ENABLED=true

# ============================================
# FRONTEND CONFIGURATION
# ============================================
FRONTEND_URL=http://localhost:3000
VITE_API_URL=http://localhost:3001/api
VITE_WS_URL=ws://localhost:3001
VITE_GRAPHQL_URL=http://localhost:3001/graphql

# ============================================
# CORS CONFIGURATION
# ============================================
CORS_ORIGIN=http://localhost:3000  # Comma-separated for multiple origins
CORS_CREDENTIALS=true

# ============================================
# EMAIL / SMTP CONFIGURATION
# ============================================
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false  # true for 465, false for other ports
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM_NAME=ClickView Enterprise
SMTP_FROM_EMAIL=noreply@clickview.com

# Email Templates
EMAIL_VERIFICATION_ENABLED=true
EMAIL_VERIFICATION_EXPIRES=24h
PASSWORD_RESET_EXPIRES=1h
INVITE_LINK_EXPIRES=7d

# ============================================
# SSO / OAUTH CONFIGURATION
# ============================================
# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:3001/api/auth/google/callback

# Microsoft Azure AD
AZURE_CLIENT_ID=your-azure-client-id
AZURE_CLIENT_SECRET=your-azure-client-secret
AZURE_TENANT_ID=your-azure-tenant-id
AZURE_CALLBACK_URL=http://localhost:3001/api/auth/azure/callback

# Okta
OKTA_DOMAIN=your-domain.okta.com
OKTA_CLIENT_ID=your-okta-client-id
OKTA_CLIENT_SECRET=your-okta-client-secret
OKTA_CALLBACK_URL=http://localhost:3001/api/auth/okta/callback

# SAML
SAML_ENABLED=false
SAML_ENTRY_POINT=https://your-idp.com/sso
SAML_ISSUER=clickview-enterprise
SAML_CALLBACK_URL=http://localhost:3001/api/auth/saml/callback
SAML_CERT=  # Base64 encoded certificate

# ============================================
# FILE STORAGE
# ============================================
STORAGE_TYPE=local  # Options: local, s3, azure, gcs

# Local Storage
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760  # 10MB in bytes

# AWS S3 (if STORAGE_TYPE=s3)
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
AWS_S3_BUCKET=clickview-uploads

# Azure Blob Storage (if STORAGE_TYPE=azure)
AZURE_STORAGE_ACCOUNT=your-storage-account
AZURE_STORAGE_KEY=your-storage-key
AZURE_STORAGE_CONTAINER=clickview-uploads

# Google Cloud Storage (if STORAGE_TYPE=gcs)
GCS_PROJECT_ID=your-project-id
GCS_KEYFILE_PATH=/path/to/keyfile.json
GCS_BUCKET=clickview-uploads

# ============================================
# CLICKUP INTEGRATION
# ============================================
CLICKUP_WEBHOOK_SECRET=your-webhook-secret-from-clickup
CLICKUP_API_BASE_URL=https://api.clickup.com/api/v2
CLICKUP_RATE_LIMIT=100  # Requests per minute

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_WINDOW_MS=60000  # 1 minute
RATE_LIMIT_MAX_REQUESTS=100  # Max requests per window
RATE_LIMIT_SKIP_SUCCESSFUL=false

# API-specific rate limits
AUTH_RATE_LIMIT_MAX=10  # Login attempts per window
AUTH_RATE_LIMIT_WINDOW_MS=900000  # 15 minutes

# ============================================
# LOGGING & MONITORING
# ============================================
LOG_LEVEL=info  # Options: error, warn, info, http, verbose, debug, silly
LOG_FORMAT=json  # Options: json, simple, combined
LOG_DIR=./logs
LOG_MAX_SIZE=20m  # Max log file size before rotation
LOG_MAX_FILES=14d  # Keep logs for 14 days
LOG_DATE_PATTERN=YYYY-MM-DD

# Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=90

# ============================================
# WEBSOCKET / SOCKET.IO
# ============================================
WS_PORT=3001  # Same as backend port
WS_PATH=/socket.io
WS_PING_TIMEOUT=60000
WS_PING_INTERVAL=25000
WS_MAX_HTTP_BUFFER_SIZE=1000000  # 1MB

# ============================================
# GRAPHQL CONFIGURATION
# ============================================
GRAPHQL_PLAYGROUND_ENABLED=false  # Disable in production
GRAPHQL_INTROSPECTION=false  # Disable in production
GRAPHQL_DEBUG=false  # Disable in production
GRAPHQL_QUERY_DEPTH_LIMIT=10
GRAPHQL_QUERY_COMPLEXITY_LIMIT=1000

# ============================================
# PERFORMANCE & OPTIMIZATION
# ============================================
# Compression
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6  # 0-9, higher = better compression but slower

# Request Body Limits
REQUEST_SIZE_LIMIT=10mb
JSON_LIMIT=10mb
URL_ENCODED_LIMIT=10mb

# Keep-Alive
KEEP_ALIVE_TIMEOUT=65000  # milliseconds

# ============================================
# MONITORING & ALERTS
# ============================================
# Prometheus
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_ENABLED=false
GRAFANA_PORT=3002

# Sentry (Error Tracking)
SENTRY_DSN=  # Your Sentry DSN
SENTRY_ENVIRONMENT=production
SENTRY_SAMPLE_RATE=1.0
SENTRY_TRACES_SAMPLE_RATE=0.1

# New Relic
NEW_RELIC_ENABLED=false
NEW_RELIC_LICENSE_KEY=
NEW_RELIC_APP_NAME=ClickView Enterprise

# Health Checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ============================================
# FEATURE FLAGS
# ============================================
FEATURE_AI_INSIGHTS=true
FEATURE_NLQ=true
FEATURE_ANOMALY_DETECTION=true
FEATURE_REPORT_BUILDER=true
FEATURE_EXPORT_PDF=true
FEATURE_EXPORT_EXCEL=true
FEATURE_SCHEDULED_REPORTS=true
FEATURE_EMAIL_REPORTS=true
FEATURE_SFTP_DISTRIBUTION=true
FEATURE_REAL_TIME_COLLABORATION=true
FEATURE_AUDIT_LOGS=true
FEATURE_SSO=true
FEATURE_MFA=true
FEATURE_RBAC=true
FEATURE_ABAC=true
FEATURE_DATA_LINEAGE=true
FEATURE_VERSION_CONTROL=true

# ============================================
# AI/ML CONFIGURATION
# ============================================
# OpenAI (for NLQ)
OPENAI_API_KEY=your-openai-api-key
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000
OPENAI_TEMPERATURE=0.7

# Anthropic Claude (alternative)
ANTHROPIC_API_KEY=your-anthropic-api-key
ANTHROPIC_MODEL=claude-3-opus-20240229

# AI Model Selection
AI_PROVIDER=openai  # Options: openai, anthropic, azure-openai

# Anomaly Detection
ANOMALY_DETECTION_THRESHOLD=2.5  # Standard deviations
ANOMALY_DETECTION_WINDOW_DAYS=30
ANOMALY_DETECTION_MIN_SAMPLES=10

# ============================================
# SCHEDULED JOBS / CRON
# ============================================
CRON_ENABLED=true
CRON_CACHE_CLEANUP=0 */5 * * *  # Every 5 minutes
CRON_REPORT_GENERATION=0 0 * * *  # Daily at midnight
CRON_ANOMALY_DETECTION=0 */6 * * *  # Every 6 hours
CRON_BACKUP=0 2 * * *  # Daily at 2 AM
CRON_AUDIT_LOG_CLEANUP=0 3 * * 0  # Weekly on Sunday at 3 AM

# ============================================
# BACKUP & DISASTER RECOVERY
# ============================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION=./backups
BACKUP_S3_BUCKET=  # Optional: S3 bucket for remote backups
BACKUP_ENCRYPT=true

# ============================================
# TIMEZONE & LOCALE
# ============================================
TZ=UTC
LOCALE=en-US
DATE_FORMAT=YYYY-MM-DD
TIME_FORMAT=HH:mm:ss

# ============================================
# DEVELOPMENT / DEBUG
# ============================================
DEBUG=false
VERBOSE_LOGGING=false
PRETTY_PRINT_JSON=false
STACK_TRACE_LIMIT=10

# SQL Query Logging
LOG_SQL_QUERIES=false
LOG_SLOW_QUERIES=true
SLOW_QUERY_THRESHOLD_MS=1000

# ============================================
# DOCKER-SPECIFIC
# ============================================
# These are typically not needed in .env as they're in docker-compose.yml
# but can override if needed

COMPOSE_PROJECT_NAME=clickview
DOCKER_RESTART_POLICY=unless-stopped

# ============================================
# ADVANCED SECURITY
# ============================================
# Content Security Policy
CSP_ENABLED=true
CSP_DIRECTIVES=default-src 'self' http: https: data: blob: 'unsafe-inline'

# HTTP Security Headers
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true

# API Key Authentication (for service-to-service)
API_KEY_ENABLED=false
API_KEY_HEADER=X-API-Key

# IP Whitelist (comma-separated)
IP_WHITELIST=

# ============================================
# COMPLIANCE
# ============================================
GDPR_ENABLED=true
DATA_RETENTION_DAYS=730  # 2 years
AUDIT_TRAIL_ENABLED=true
ENCRYPTION_AT_REST=true
ENCRYPTION_IN_TRANSIT=true

# ============================================
# NOTES
# ============================================
# 1. Generate secure random keys:
#    node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
#
# 2. For production deployment:
#    - Change all default passwords
#    - Use strong random keys for JWT, encryption, session
#    - Enable HTTPS and set SESSION_SECURE=true
#    - Disable GraphQL playground and introspection
#    - Enable monitoring and alerting
#    - Configure proper CORS origins
#    - Set up database backups
#    - Configure email/SMTP for notifications
#
# 3. For Docker deployment:
#    - Copy this file to .env in project root
#    - Adjust DB_HOST, REDIS_HOST to service names from docker-compose.yml
#    - Configure volume mounts for persistent data
#
# 4. Security checklist:
#    - [ ] All default passwords changed
#    - [ ] Strong random keys generated
#    - [ ] HTTPS enabled in production
#    - [ ] CORS properly configured
#    - [ ] Rate limiting enabled
#    - [ ] MFA enabled for admin accounts
#    - [ ] Audit logging enabled
#    - [ ] Database backups configured
#    - [ ] Monitoring and alerting set up
